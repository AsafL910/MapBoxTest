pipeline {
  agent {
    docker {
      image 'docker:20.10.7'
      args '-v /var/run/docker.sock:/var/run/docker.sock'
    }
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Build Docker Image') {
      steps {
        script {
          dockerImage = docker.build('frontend:${env.BUILD_NUMBER}', '-f Dockerfile .')
        }
      }
    }

    stage('Stash Docker Image') {
      steps {
        stash name: 'docker-image', includes: 'frontend*.tar'
      }
    }
  }

  post {
    success {
      unstash 'docker-image'
    }
  }
}
